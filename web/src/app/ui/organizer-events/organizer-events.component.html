<app-organizer-nav-bar></app-organizer-nav-bar>
<main class="col-10 bg-body-tertiary" id="main">
    <div class="container">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
            id="title">
            <h2>Events</h2>
        </div>
        <div class="row">
        </div>

        <h5>Upcoming Events</h5>

        <table class="table align-middle mb-0 bg-white">
            <thead class="bg-light">
                <tr>
                    <th>Name</th>
                    <th>Latitude</th>
                    <th>Longitude</th>
                    <th>Event Types</th>
                    <th>Purchases</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let event of eventList">
                    <td>
                        <div class="d-flex align-items-center">
                            <img [src]="'http://localhost:8080/event/download-event-photo/'+event.uuid+'/number/'+0"
                                style="width: 45px; height: 45px" class="rounded" />
                            <div class="ms-3">
                                <p class="fw-bold mb-1">{{event.name}}</p>
                                <p class="text-muted mb-0">{{formatDateString(event.dateTime.toString())}}</p>
                            </div>
                        </div>
                    </td>
                    <td>
                        <p class="fw-normal mb-1">{{event.latitude}}</p>
                    </td>
                    <td>
                        <p class="fw-normal mb-1">{{event.longitude}}</p>
                    </td>
                    <td>
                        <span *ngFor="let item of event.eventType" class="rounded-pill text-sm py-1 px-2 d-inline"
                            [ngStyle]="{'background-color': convertColorCode(item.colorCode), 'color': '#fff', 'font-size': '10px'}">{{item.name}}</span>
                    </td>
                    <td class="text-center">{{event.students.length}}</td>
                    <td>
                        <button (click)="openModal(content, event)" type="button"
                            class="btn btn-link btn-sm btn-rounded">
                            Edit
                        </button>
                    </td>

                    <ng-template #content let-modal>
                        <div class="modal-header">
                            <h5 class="modal-title" id="modal-title">Edita el coste</h5>
                            <button type="button" class="close transparent-close" aria-label="Close"
                                (click)="modal.dismiss('Cross click')">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form (ngSubmit)="f.form.valid && onSubmit()" #f="ngForm" novalidate>
                                <div class="form-group">
                                    <label for="id">Id</label>
                                    <input type="text" class="form-control" id="id" name="id" [value]="eventDetails.id"
                                        readonly>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-3 mb-2">
                                        <div class="card position-relative upload-placeholder"
                                            (click)="fileInput.click()">
                                            <div class="card-body d-flex justify-content-center align-items-center">
                                                <i class="bi bi-upload" style="font-size: 40px;"></i>
                                            </div>
                                            <input type="file" #fileInput class="d-none" (change)="onFileChange($event)"
                                                accept="image/*" multiple>
                                        </div>
                                    </div>

                                    <div class="col-3 mb-2" *ngFor="let img of imagePreviews; let i = index">
                                        <div class="card position-relative rounded">
                                            <img [src]="img" class="card-img-top" alt="Uploaded image preview"
                                                (click)="openModalImage(img, imageModal)">
                                            <button type="button" class="btn-close position-absolute top-0 end-0 m-2"
                                                aria-label="Close" (click)="removeImage(i)"></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group mt-2">
                                    <label for="startDate">Date</label>
                                    <input [value]="formatDateString(eventDetails.date)" type="text"
                                        class="form-control" id="startDate" name="startDate" readonly>
                                </div>
                                <div class="form-group mt-2">
                                    <label for="finalDate">Event name</label>
                                    <input type="text" class="form-control" id="finalDate" name="finalDate"
                                        [value]="eventDetails.name" readonly>
                                </div>
                                <div class="form-group mt-2">
                                    <label for="cost">Description</label>
                                    <textarea [(ngModel)]="eventDetails.description" class="form-control" type="text"
                                        name="description" id="description" required #description="ngModel"></textarea>
                                    <div class="alert-danger mt-1" *ngIf="description.errors && f.submitted">
                                        <div class="error" *ngIf="description.errors['required']">Cost is required</div>
                                        <div class="error" *ngIf="description.errors['min']">The minimum cost is 0€
                                        </div>
                                        <div class="error" *ngIf="description.errors['max']">The maximum cost is 100€
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group mt-2">
                                    <label for="cost">Cost</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">€</span>
                                        </div>
                                        <input [(ngModel)]="eventDetails.price" class="form-control" type="number"
                                            name="cost" id="cost" required min="0" max="1000" #cost="ngModel"
                                            step="0.01" />
                                    </div>
                                    <div class="alert-danger mt-1" *ngIf="cost.errors && f.submitted">
                                        <div class="error" *ngIf="cost.errors['required']">Cost is required</div>
                                        <div class="error" *ngIf="cost.errors['min']">The minimum cost is 0€</div>
                                        <div class="error" *ngIf="cost.errors['max']">The maximum cost is 1009€</div>
                                    </div>
                                </div>
                                <div class="form-group mt-2">
                                    <label for="bike">Max Capacity</label>
                                    <input type="text" class="form-control" id="bike" name="bike"
                                        [value]="eventDetails.maxCapacity" readonly>
                                </div>
                                <div class="form-group mt-2">
                                    <label for="station">City</label>
                                    <input type="text" class="form-control" id="station" name="station"
                                        [value]="eventDetails.city" readonly>
                                </div>
                                <div class="form-group mt-2">
                                    <label for="username">Place</label>
                                    <input type="text" class="form-control" id="username" name="username"
                                        [value]="eventDetails.latitude" readonly>
                                </div>
                                <!--<mat-form-field>
                                    <mat-label>Address using the directive</mat-label>
                                    
                                </mat-form-field>-->
                                <button type="submit"
                                    class="btn btn-gray btn-transparent d-flex justify-content-center align-items-center"
                                    style="width: 100%; margin-top: 10px;">
                                    Save
                                </button>
                            </form>
                        </div>
                    </ng-template>
                    <ng-template #imageModal let-modal>
                        <div class="modal-body" [ngStyle]="{'width.px': imageWidth, 'height.px': imageHeight}">
                            <img [src]="selectedImage" class="img-fluid" alt="Image preview">
                        </div>
                    </ng-template>
                </tr>
            </tbody>
        </table>

        <div class="d-flex justify-content-center mt-4">
            <ngb-pagination class="custom-pagination" [maxSize]="10" [boundaryLinks]="true"
                [collectionSize]="countFutureEvents" [(page)]="pageForPaginationFuture" [pageSize]="10"
                (pageChange)="loadNewPageFuture()" aria-label="Default pagination">
            </ngb-pagination>
        </div>

        <h5>Past Events</h5>

        <table class="table align-middle mb-0 bg-white">
            <thead class="bg-light">
                <tr>
                    <th>Name</th>
                    <th>Latitude</th>
                    <th>Longitude</th>
                    <th>Event Types</th>
                    <th>Purchases</th>
                    <th>Total Revenue</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let event of eventListPast">
                    <td>
                        <div class="d-flex align-items-center">
                            <img [src]="'http://localhost:8080/event/download-event-photo/'+event.uuid+'/number/'+0"
                                style="width: 45px; height: 45px" class="rounded" />
                            <div class="ms-3">
                                <p class="fw-bold mb-1">{{event.name}}</p>
                                <p class="text-muted mb-0">{{formatDateString(event.dateTime.toString())}}</p>
                            </div>
                        </div>
                    </td>
                    <td>
                        <p class="fw-normal mb-1">{{event.latitude}}</p>
                    </td>
                    <td>
                        <p class="fw-normal mb-1">{{event.longitude}}</p>
                    </td>
                    <td>
                        <span *ngFor="let item of event.eventType" class="rounded-pill text-sm py-1 px-2 d-inline"
                            [ngStyle]="{'background-color': item.cssColor, 'color': '#fff', 'font-size': '10px'}">{{item.name}}</span>
                    </td>
                    <td class="text-center">{{event.students.length}}</td>
                    <td>
                        <button type="button" class="btn btn-link btn-sm btn-rounded">
                            Edit
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="d-flex justify-content-center mt-4">
            <ngb-pagination class="custom-pagination" [maxSize]="10" [boundaryLinks]="true"
                [collectionSize]="countPastEvents" [(page)]="pageForPaginationPast" [pageSize]="10"
                (pageChange)="loadNewPagePast()" aria-label="Default pagination">
            </ngb-pagination>
        </div>
    </div>
</main>